{% extends 'CheckObjection/CheckObjectionApp_base.html' %}
{% block title %}ç®—æ³•å®éªŒå®¤ - æäº¤æƒ…å†µ{% endblock %}
{% block head %}
    {% load static %}
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{{ page_title|default:"æäº¤è®°å½•" }}</title>
        <link rel="stylesheet" href="{% static 'bootstrap5/css/bootstrap.min.css' %}">
        <style>
            /* è‡ªå®šä¹‰é²œè‰³é¢œè‰² - ç¡®ä¿æ‰€æœ‰çŠ¶æ€éƒ½æœ‰å¯¹åº”æ ·å¼ */
            .bg-accepted {
                background-color: #10b981 !important;
                color: white;
            }

            /* äº®ç»¿è‰² */
            .bg-wrong-answer {
                background-color: #ef4444 !important;
                color: white;
            }

            /* äº®çº¢è‰² */
            .bg-compilation-error {
                background-color: #f97316 !important;
                color: white;
            }

            /* æ©™è‰² */
            .bg-time-limit {
                background-color: #8b5cf6 !important;
                color: white;
            }

            /* äº®ç´«è‰² */
            .bg-memory-limit {
                background-color: #ec4899 !important;
                color: white;
            }

            /* äº®ç²‰è‰² */
            .bg-runtime-error {
                background-color: #6b7280 !important;
                color: white;
            }

            /* æ·±ç°è‰² */
            .bg-internal-error {
                background-color: #f43f5e !important;
                color: white;
            }

            /* äº®çº¢è‰²ç³» */
            .bg-running {
                background-color: #f59e0b !important;
                color: white;
            }

            /* ç¥ç€è‰² */

            .table-hover tbody tr:hover {
                background-color: rgba(59, 130, 246, 0.08);
                transform: translateY(-1px);
                transition: all 0.2s ease;
            }

            .status-badge {
                font-size: 0.75rem;
                font-weight: 600;
                padding: 0.35em 0.65em;
                border-radius: 0.375rem;
                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            }

            .language-badge {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                font-weight: 500;
            }

            .user-badge {
                background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                color: white;
                font-weight: 500;
            }

            .table-header {
                background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
                color: white;
            }

            .table-header th {
                border: none;
                font-weight: 600;
                padding: 1rem 0.75rem;
            }
        </style>
    </head>
{% endblock %}
{% block main %}

    <body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h1 class="mb-4 text-gradient"
                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    {{ page_title|default:"æäº¤è®°å½•" }}
                </h1>

                {% if submissions and submissions|length > 0 %}
                    <div class="table-responsive">
                        <table class="table table-striped table-hover border">
                            <thead class="table-header">
                            <tr>
                                <th>ç”¨æˆ·å</th>
                                <th>é¢˜ç›®ID</th>
                                <th>æ ‡é¢˜</th>
                                <th>è¯­è¨€</th>
                                <th>çŠ¶æ€</th>
                                <th>ç»“æœ</th>
                                <th>æäº¤æ—¶é—´</th>
                                <th>æ“ä½œ</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for submission in submissions %}
                                <tr class="align-middle">
                                    <!-- ç”¨æˆ·å -->
                                    <td>
                                    <span class="badge user-badge status-badge">
                                        {% if submission.user_name %}
                                            {{ submission.user_name }}
                                        {% else %}
                                            <span class="text-muted">åŒ¿åç”¨æˆ·</span>
                                        {% endif %}
                                    </span>
                                    </td>

                                    <!-- é¢˜ç›®ID -->
                                    <td>
                                        <strong class="text-primary">
                                            {% if submission.topic_id %}
                                                {{ submission.topic_id }}
                                            {% else %}
                                                <span class="text-muted">æœªçŸ¥</span>
                                            {% endif %}
                                        </strong>
                                    </td>
                                    <!-- æ ‡é¢˜ -->
                                    <td>
                                        <strong class="text-primary">
                                            {% if submission.topic.title %}
                                                {{ submission.topic.title }}
                                            {% else %}
                                                <span class="text-muted">æœªçŸ¥</span>
                                            {% endif %}
                                        </strong>
                                    </td>


                                    <!-- è¯­è¨€ -->
                                    <td>
                                        <span class="badge language-badge status-badge">
                                            {% if submission.language_id %}
                                                {% if submission.language_id == 71 %}
                                                    ğŸ Python
                                                {% elif submission.language_id == 54 %}
                                                    âš¡ C++
                                                {% elif submission.language_id == 62 %}
                                                    â˜• Java
                                                {% elif submission.language_id == 63 %}
                                                    ğŸŸ¨ JavaScript
                                                {% elif submission.language_id == 50 %}
                                                    âš™ï¸ C
                                                {% else %}
                                                    å…¶ä»– ({{ submission.language_id }})
                                                {% endif %}
                                            {% else %}
                                                æœªçŸ¥
                                            {% endif %}
                                        </span>
                                    </td>

                                    <!-- çŠ¶æ€ -->
                                    <td>
                                        {% if submission.status %}
                                            {% if submission.status == 'Accepted' %}
                                                <span class="badge bg-accepted status-badge">âœ… {{ submission.status }}</span>
                                            {% elif submission.status == 'Wrong Answer' %}
                                                <span class="badge bg-wrong-answer status-badge">âŒ {{ submission.status }}</span>
                                            {% elif submission.status == 'Running' %}
                                                <span class="badge bg-running status-badge">â³ {{ submission.status }}</span>
                                            {% elif submission.status == 'Compilation Error' %}
                                                <span class="badge bg-compilation-error status-badge">ğŸ”§ {{ submission.status }}</span>
                                            {% elif submission.status == 'Time Limit Exceeded' %}
                                                <span class="badge bg-time-limit status-badge">â° {{ submission.status }}</span>
                                            {% elif submission.status == 'Memory Limit Exceeded' %}
                                                <span class="badge bg-memory-limit status-badge">ğŸ’¾ {{ submission.status }}</span>
                                            {% elif submission.status == 'Runtime Error' %}
                                                <span class="badge bg-runtime-error status-badge">ğŸ’¥ {{ submission.status }}</span>
                                            {% elif submission.status == 'Internal Error' %}
                                                <span class="badge bg-internal-error status-badge">âš ï¸ {{ submission.status }}</span>
                                            {% else %}
                                                <span class="badge bg-secondary status-badge">{{ submission.status }}</span>
                                            {% endif %}
                                        {% else %}
                                            <span class="badge bg-light text-dark status-badge">æœªè®¾ç½®</span>
                                        {% endif %}
                                    </td>

                                    <!-- ç»“æœ -->
                                    <td>
                                        {% if submission.overall_result %}
                                            {% if submission.overall_result == 'Accepted' %}
                                                <span class="badge bg-accepted status-badge">âœ… Accepted</span>
                                            {% elif submission.overall_result == 'Wrong Answer' %}
                                                <span class="badge bg-wrong-answer status-badge">âŒ Wrong Answer</span>
                                            {% elif submission.overall_result == 'Compilation Error' %}
                                                <span class="badge bg-compilation-error status-badge">ğŸ”§ Compilation Error</span>
                                                <!-- æ–°å¢ï¼šå¤„ç† Timeout çŠ¶æ€ï¼ˆä¸è¶…æ—¶å…±ç”¨æ ·å¼ï¼‰ -->
                                            {% elif submission.overall_result in 'Time Limit Exceeded, Timeout' %}
                                                <span class="badge bg-time-limit status-badge">â° {{ submission.overall_result }}</span>
                                            {% elif submission.overall_result == 'Memory Limit Exceeded' %}
                                                <span class="badge bg-memory-limit status-badge">ğŸ’¾ Memory Limit Exceeded</span>
                                            {% elif submission.overall_result == 'Runtime Error' %}
                                                <span class="badge bg-runtime-error status-badge">ğŸ’¥ Runtime Error</span>
                                            {% elif submission.overall_result == 'Internal Error' %}
                                                <span class="badge bg-internal-error status-badge">âš ï¸ Internal Error</span>
                                                <!-- å…¶ä»–çŠ¶æ€ï¼ˆä¿æŒä¹‹å‰è¡¥å……çš„ï¼‰ -->
                                            {% elif submission.overall_result == 'Pending' %}
                                                <span class="badge bg-pending status-badge">â³ Pending</span>
                                            {% elif submission.overall_result == 'Judging' %}
                                                <span class="badge bg-judging status-badge">ğŸ” Judging</span>
                                            {% elif submission.overall_result == 'Partial Accepted' %}
                                                <span class="badge bg-partial-accepted status-badge">ğŸŸ¡ Partial Accepted</span>
                                            {% elif submission.overall_result == 'Output Limit Exceeded' %}
                                                <span class="badge bg-output-limit status-badge">ğŸ“¤ Output Limit Exceeded</span>
                                            {% elif submission.overall_result == 'Presentation Error' %}
                                                <span class="badge bg-presentation-error status-badge">ğŸ“ Presentation Error</span>
                                            {% elif submission.overall_result == 'Restricted Function' %}
                                                <span class="badge bg-restricted-function status-badge">ğŸš« Restricted Function</span>
                                            {% else %}
                                                <span class="badge bg-secondary status-badge">{{ submission.overall_result }}</span>
                                            {% endif %}
                                        {% else %}
                                            <span class="badge bg-light text-dark status-badge">-</span>
                                        {% endif %}
                                    </td>

                                    <!-- æäº¤æ—¶é—´ -->
                                    <td>
                                        <small class="text-muted">
                                            {% if submission.created_at %}
                                                {{ submission.created_at|date:"Y-m-d H:i:s" }}
                                            {% else %}
                                                <span class="text-muted">æœªçŸ¥æ—¶é—´</span>
                                            {% endif %}
                                        </small>
                                    </td>

                                    <!-- æ“ä½œ -->
                                    <td>
                                        {% if submission.id %}
                                            <a href="{% url 'CheckObjectionApp:submission_detail' pk=submission.id %}"
                                               class="btn btn-sm btn-outline-primary rounded-pill px-3">
                                                æŸ¥çœ‹è¯¦æƒ…
                                            </a>
                                        {% else %}
                                            <button class="btn btn-sm btn-outline-secondary rounded-pill" disabled>
                                                æ— æ•ˆè®°å½•
                                            </button>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <div class="cache-info">
                        <small class="text-muted">
                            {% if cache_status %}
                                æ•°æ®æ¥æº: {{ cache_status }} |
                                ç¼“å­˜æŒç»­æ—¶é—´: {{ cache_timeout }}ç§’ |
                                <a href="{% url 'CheckObjectionApp:clear_my_submission_cache' %}">æ¸…é™¤æˆ‘çš„ç¼“å­˜</a>
                            {% else %}
                                æ•°æ®æ¥æº: æ•°æ®åº“ï¼Œç¼“å­˜æœªå¯ç”¨
                            {% endif %}
                        </small>
                    </div>

                    <!-- åˆ†é¡µ -->
                    {% if is_paginated and page_obj %}
                        <nav aria-label="Page navigation" class="mt-4">
                            <ul class="pagination justify-content-center">
                                {% if page_obj.has_previous %}
                                    <li class="page-item">
                                        <a class="page-link border-0 shadow-sm" href="?page=1"
                                           style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">é¦–é¡µ</a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link border-0 shadow-sm"
                                           href="?page={{ page_obj.previous_page_number }}"
                                           style="background: #f8f9fa; color: #4f46e5;">ä¸Šä¸€é¡µ</a>
                                    </li>
                                {% else %}
                                    <li class="page-item disabled">
                                        <span class="page-link border-0">é¦–é¡µ</span>
                                    </li>
                                    <li class="page-item disabled">
                                        <span class="page-link border-0">ä¸Šä¸€é¡µ</span>
                                    </li>
                                {% endif %}

                                <li class="page-item disabled">
                            <span class="page-link border-0 text-dark">
                                ç¬¬
                                <strong class="text-primary">{{ page_obj.number|default:1 }}</strong> é¡µï¼Œå…±
                                <strong class="text-primary">{{ page_obj.paginator.num_pages|default:1 }}</strong> é¡µ
                            </span>
                                </li>

                                {% if page_obj.has_next %}
                                    <li class="page-item">
                                        <a class="page-link border-0 shadow-sm"
                                           href="?page={{ page_obj.next_page_number }}"
                                           style="background: #f8f9fa; color: #4f46e5;">ä¸‹ä¸€é¡µ</a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link border-0 shadow-sm"
                                           href="?page={{ page_obj.paginator.num_pages }}"
                                           style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">æœ«é¡µ</a>
                                    </li>
                                {% else %}
                                    <li class="page-item disabled">
                                        <span class="page-link border-0">ä¸‹ä¸€é¡µ</span>
                                    </li>
                                    <li class="page-item disabled">
                                        <span class="page-link border-0">æœ«é¡µ</span>
                                    </li>
                                {% endif %}
                            </ul>
                        </nav>
                    {% endif %}

                {% else %}
                    <div class="alert alert-info text-center border-0 shadow-sm"
                         style="background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%); border-left: 4px solid #4f46e5 !important;">
                        <h4 class="text-primary">ğŸ“ æš‚æ— æäº¤è®°å½•</h4>
                        <p class="text-muted mb-0">æ‚¨è¿˜æ²¡æœ‰ä»»ä½•ä»£ç æäº¤è®°å½•ã€‚</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const links = document.querySelectorAll('a[href="#"], a[href=""]');
            links.forEach(link => {
                link.addEventListener('click', function (e) {
                    if (!this.getAttribute('href') || this.getAttribute('href') === '#') {
                        e.preventDefault();
                        console.warn('é˜»æ­¢äº†ç©ºé“¾æ¥çš„ç‚¹å‡»');
                    }
                });
            });

            // æ·»åŠ è¡Œç‚¹å‡»æ•ˆæœ
            const tableRows = document.querySelectorAll('.table tbody tr');
            tableRows.forEach(row => {
                row.style.cursor = 'pointer';
                row.addEventListener('click', function () {
                    const link = this.querySelector('a.btn');
                    if (link) {
                        link.click();
                    }
                });
            });
        });
    </script>
    </body>
{% endblock %}