{% extends 'CheckObjection/submission/base_submission.html' %}
{% block content %}
    <!-- 题目信息区域 -->
    <div class="problem-info">
        <div class="problem-header">
            <h2 class="problem-title">{{ topic_content.title }}</h2>
        <p>比赛提交</p><a href="{% url 'CheckObjectionApp:contest_detail' pk=contest_id %}" class="btn btn-outline">返回题目列表</a>
            <div class="problem-meta">
                        <span class="tag tag-difficulty">
                            {% if topic_content.level == 0 %}
                                <i class="fas fa-star"></i> 简单
                            {% elif topic_content.level == 1 %}
                                <i class="fas fa-star-half-alt"></i> 中等
                            {% else %}
                                <i class="fas fa-star"></i> 困难
                            {% endif %}
                        </span>
            </div>
        </div>

        <div class="problem-description">
            <p>{{ topic_content.content|linebreaks }}</p>
        </div>

        <div class="problem-constraints">
            <h4>示例</h4>
            <div class="constraint-list">
                {{ topic_content.example|safe|linebreaks }}
            </div>
        </div>

        {% if topic_content.constraints %}
            <div class="problem-constraints">
                <h4>约束条件</h4>
                <div class="constraint-list">
                    {{ topic_content.constraints|safe }}
                </div>
            </div>
        {% endif %}
    </div>
{% endblock content %}

{% block submission_area %}

    <!-- 代码提交区域 -->
    <div class="submission-area">
        <div class="submission-header">
            <h2 class="submission-title">提交解答</h2>
            <div class="language-selector">
                <label for="language-select">编程语言:</label>
                <select id="language-select" name="language_id">
                    <option value="71" selected>Python</option>
                    <option value="63">JavaScript</option>
                    <option value="62">Java</option>
                    <option value="54">C++</option>
                    <option value="50">C</option>
                </select>
            </div>
        </div>

        <form id="submission-form">
            {% csrf_token %}
            <input type="hidden" name="topic_id" value="{{ topic_content.id }}">
            <input type="hidden" name="user_name" value="{{ user.username }}">
            <input type="hidden" id="language_id" name="language_id" value="71">

            <div class="form-group">
                <label for="code">代码编辑器 <small>(支持代码提示和自动补全)</small></label>
                <div class="code-editor-container">
                    <div class="editor-header">
                        <span id="current-language">Python</span>
                        <div class="editor-actions">
                            <button type="button" class="editor-action-btn" onclick="formatCode()"
                                    title="格式化代码">
                                <i class="fas fa-indent"></i> 格式化
                            </button>
                            <button type="button" class="editor-action-btn" onclick="resetCode()"
                                    title="重置代码">
                                <i class="fas fa-redo"></i> 重置
                            </button>
                        </div>
                    </div>
                    <!-- Monaco Editor 容器 -->
                    <div id="monaco-editor"></div>
                </div>
            </div>

            <div class="form-group">
                <label for="notes">备注（可选）</label>
                <input name="notes" type="text" id="notes" placeholder="添加关于你解决方案的备注...">
            </div>

            <!-- 提交成功消息 -->
            <div class="success-message" id="success-message">
                <i class="fas fa-check-circle"></i>
                <strong>提交成功！</strong> 代码已提交到服务器，请点击"查看结果"按钮获取执行结果。
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>代码执行中，请稍候...</p>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-outline" onclick="runTest()">
                    <i class="fas fa-play"></i> 测试运行
                </button>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-paper-plane"></i> 提交执行
                </button>
                <button type="button" class="btn btn-success" id="check-result-btn" style="display: none;"
                        onclick="checkResult()">
                    <i class="fas fa-search"></i> 查看结果
                </button>
            </div>
        </form>

        <!-- 执行结果区域 -->
        <div class="result-area" id="result-area" style="display: none;">
            <div class="result-header">
                <h2 class="result-title">执行结果</h2>
                <button type="button" class="btn btn-outline" onclick="clearResults()"
                        style="padding: 8px 12px;">
                    <i class="fas fa-times"></i> 清除结果
                </button>
            </div>
            <div class="result-content" id="result-content">
                <!-- 结果将在这里显示 -->
            </div>
        </div>
    </div>
{% endblock submission_area %}
