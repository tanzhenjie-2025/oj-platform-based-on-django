<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Django 流式输出演示</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        dark: '#1E293B',
                        terminal: '#0F172A',
                    },
                    fontFamily: {
                        mono: ['Fira Code', 'Consolas', 'Monaco', 'monospace'],
                    },
                }
            }
        }
    </script>

    <style>
        /* 自定义滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1E293B;
        }
        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748B;
        }

        /* 光标闪烁动画 */
        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: #10B981 }
        }

        .typing-cursor {
            border-right: .15em solid #10B981;
            animation: blink-caret .75s step-end infinite;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen flex flex-col">
    <!-- 导航栏 -->
    <header class="bg-white shadow-md sticky top-0 z-50 transition-all duration-300">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-code text-primary text-2xl"></i>
                <h1 class="text-xl font-bold text-dark">Django 流式输出演示</h1>
            </div>
            <nav>
                <ul class="flex space-x-6">
                    <li><a href="#" class="text-slate-600 hover:text-primary transition-colors"><i class="fa fa-home mr-1"></i>首页</a></li>
                    <li><a href="#" class="text-slate-600 hover:text-primary transition-colors"><i class="fa fa-info-circle mr-1"></i>关于</a></li>
                    <li><a href="#" class="text-slate-600 hover:text-primary transition-colors"><i class="fa fa-github mr-1"></i>源码</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- 主要内容区 -->
    <main class="flex-grow container mx-auto px-4 py-8">
        <section class="max-w-4xl mx-auto">
            <div class="mb-6">
                <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-dark mb-2">实时流式输出展示</h2>
                <p class="text-slate-600 mb-6">这个演示模拟了Django后端向前端流式发送数据的效果。点击下方按钮开始/停止演示。</p>

                <!-- 控制按钮 -->
                <div class="flex flex-wrap gap-4 mb-6">
                    <button id="startBtn" class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-6 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 flex items-center">
                        <i class="fa fa-play mr-2"></i>开始演示
                    </button>
                    <button id="stopBtn" class="bg-slate-600 hover:bg-slate-700 text-white font-medium py-2 px-6 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 flex items-center" disabled>
                        <i class="fa fa-stop mr-2"></i>停止演示
                    </button>
                    <button id="clearBtn" class="bg-slate-200 hover:bg-slate-300 text-slate-800 font-medium py-2 px-6 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 flex items-center">
                        <i class="fa fa-trash mr-2"></i>清空内容
                    </button>
                </div>

                <!-- 流式输出区域 -->
                <div class="bg-terminal rounded-lg shadow-lg overflow-hidden">
                    <div class="bg-slate-800 text-slate-300 px-4 py-2 flex justify-between items-center border-b border-slate-700">
                        <div class="flex items-center space-x-2">
                            <i class="fa fa-terminal"></i>
                            <span>输出终端</span>
                        </div>
                        <div class="flex space-x-2">
                            <span id="statusIndicator" class="inline-block w-2 h-2 rounded-full bg-slate-600"></span>
                            <span id="statusText" class="text-sm">未运行</span>
                        </div>
                    </div>
                    <div id="outputContainer" class="h-[400px] overflow-y-auto p-4 font-mono text-sm text-slate-200">
                        <div class="text-slate-400 mb-2">等待开始演示...</div>
                        <div id="outputContent"></div>
                        <div id="typingIndicator" class="inline"></div>
                    </div>
                </div>
            </div>

            <!-- 说明部分 -->
            <div class="bg-white rounded-lg shadow-md p-6 mt-8">
                <h3 class="text-xl font-semibold mb-4 text-dark">技术说明</h3>
                <p class="text-slate-700 mb-4">在Django项目中实现流式输出通常可以通过以下方式：</p>
                <ul class="list-disc pl-5 text-slate-700 space-y-2 mb-4">
                    <li>使用Django的StreamingHttpResponse返回流式响应</li>
                    <li>前端使用Fetch API或XMLHttpRequest接收流式数据</li>
                    <li>通过JavaScript实时更新DOM，展示流式内容</li>
                </ul>
                <p class="text-slate-700">本演示使用JavaScript模拟了后端流式发送数据的过程，实际项目中可以将模拟数据部分替换为真实的API调用。</p>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="bg-dark text-slate-400 py-6 mt-12">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <p>&copy; 2023 Django 流式输出演示. 保留所有权利.</p>
                </div>
                <div class="flex space-x-4">
                    <a href="#" class="hover:text-white transition-colors"><i class="fa fa-github text-xl"></i></a>
                    <a href="#" class="hover:text-white transition-colors"><i class="fa fa-twitter text-xl"></i></a>
                    <a href="#" class="hover:text-white transition-colors"><i class="fa fa-linkedin text-xl"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // 模拟的后端数据 - 分块发送
        const mockDataChunks = [
            "正在初始化系统...\n",
            "连接到数据库成功\n",
            "加载用户配置...\n",
            "验证权限通过\n",
            "开始处理数据...\n",
            "处理进度: 10%\n",
            "处理进度: 25%\n",
            "处理进度: 40%\n",
            "处理进度: 55%\n",
            "处理进度: 70%\n",
            "处理进度: 85%\n",
            "处理进度: 100%\n",
            "数据处理完成\n",
            "生成报告中...\n",
            "报告生成成功\n",
            "发送通知给管理员\n",
            "所有任务已完成\n"
        ];

        // DOM 元素
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const clearBtn = document.getElementById('clearBtn');
        const outputContent = document.getElementById('outputContent');
        const typingIndicator = document.getElementById('typingIndicator');
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');
        const outputContainer = document.getElementById('outputContainer');

        // 状态变量
        let isStreaming = false;
        let currentChunkIndex = 0;
        let streamInterval;

        // 开始流式输出
        startBtn.addEventListener('click', () => {
            if (isStreaming) return;

            isStreaming = true;
            currentChunkIndex = 0;
            startBtn.disabled = true;
            stopBtn.disabled = false;
            statusIndicator.className = 'inline-block w-2 h-2 rounded-full bg-green-500';
            statusText.textContent = '运行中';

            // 清空之前的提示文本
            const placeholder = outputContainer.querySelector('.text-slate-400');
            if (placeholder) placeholder.remove();

            // 开始流式输出
            streamNextChunk();
        });

        // 停止流式输出
        stopBtn.addEventListener('click', () => {
            stopStreaming();
        });

        // 清空输出内容
        clearBtn.addEventListener('click', () => {
            stopStreaming();
            outputContent.innerHTML = '';
            typingIndicator.textContent = '';
            outputContainer.insertAdjacentHTML('afterbegin', '<div class="text-slate-400 mb-2">等待开始演示...</div>');
        });

        // 停止流式处理
        function stopStreaming() {
            if (!isStreaming) return;

            isStreaming = false;
            clearTimeout(streamInterval);
            startBtn.disabled = false;
            stopBtn.disabled = true;
            statusIndicator.className = 'inline-block w-2 h-2 rounded-full bg-slate-600';
            statusText.textContent = '已停止';
            typingIndicator.textContent = '';
            typingIndicator.classList.remove('typing-cursor');
        }

        // 流式输出下一个数据块
        function streamNextChunk() {
            if (!isStreaming) return;

            // 如果所有数据块都已输出，结束流
            if (currentChunkIndex >= mockDataChunks.length) {
                typingIndicator.textContent = '';
                typingIndicator.classList.remove('typing-cursor');
                outputContent.insertAdjacentHTML('beforeend', '<div class="text-green-400 mt-2">✓ 所有数据已接收完成</div>');
                scrollToBottom();
                stopStreaming();
                return;
            }

            // 显示打字效果
            const chunk = mockDataChunks[currentChunkIndex];
            currentChunkIndex++;

            let charIndex = 0;
            typingIndicator.textContent = '';
            typingIndicator.classList.add('typing-cursor');

            // 模拟打字效果
            const typeChar = () => {
                if (charIndex < chunk.length && isStreaming) {
                    typingIndicator.textContent += chunk.charAt(charIndex);
                    charIndex++;
                    scrollToBottom();
                    setTimeout(typeChar, 30); // 控制打字速度
                } else if (isStreaming) {
                    // 一个数据块打字完成
                    typingIndicator.classList.remove('typing-cursor');
                    outputContent.insertAdjacentHTML('beforeend', `<div>${typingIndicator.textContent}</div>`);
                    typingIndicator.textContent = '';

                    // 等待一段时间再发送下一个数据块
                    streamInterval = setTimeout(streamNextChunk, 800); // 控制块之间的间隔
                }
            };

            typeChar();
        }

        // 滚动到底部
        function scrollToBottom() {
            outputContainer.scrollTop = outputContainer.scrollHeight;
        }

        // 导航栏滚动效果
        window.addEventListener('scroll', () => {
            const header = document.querySelector('header');
            if (window.scrollY > 10) {
                header.classList.add('py-2', 'shadow-lg');
                header.classList.remove('py-3', 'shadow-md');
            } else {
                header.classList.add('py-3', 'shadow-md');
                header.classList.remove('py-2', 'shadow-lg');
            }
        });
    </script>
</body>
</html>